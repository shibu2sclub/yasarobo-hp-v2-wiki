# yasarobo-hp-v2-wiki
yasarobo-hp-v2のWiki用リポジトリ

[Wiki](https://github.com/shibu2sclub/yasarobo-hp-v2-wiki/wiki)に書いていきます


## Install
事前に```Node.js```を必ずインストールしてください。LTS版、Stable版をお勧めします。環境変数も通してください。

このリポジトリをクローンしたら最初に動かす前にNext.jsや関連パッケージをインストールします。
インストールコマンドは以下の通り。

```bash
npm i
```

```npm install```と同じです。

なお、他の端末でパッケージを更新した（package-lock.jsonに変更があった）場合も同様にコマンドを打って、このプロジェクトで指定された最新の環境に合わせてください。

なお、フォルダ名に日本語名が含まれないようにしてください（Next.js v15のバグ）

## 環境変数
このページはmicroCMSでニュースを管理しています。microCMSからニュースデータを呼び出すために、サービスドメインとAPIキーを環境変数で登録する必要があります。

Cloudflare Pagesでは環境変数を登録する場所があります。これについては下で詳しく説明します。

ローカルでは、```.env.local```ファイルを作ることで環境変数を登録できます。なおこのファイルはGitには無視される設定になっているため、リポジトリをクローンしても環境変数は手作業で登録することになります。

```.env.local```を作成したうえで、以下の形式で入力します。

```
SERVICE_DOMAIN=yasarobo
API_KEY=XXXXXX
```

```XXXXXX```の部分にはAPIキーを入力します。microCMSにログインして確認してください。渋渋理科部のメールアドレスで登録しています。また、追加で権限を与えたアカウントでもログインが可能です。

## 公開する：Cloudflare Pagesにデプロイする
* Cloudflare **Pages**でこのGitリポジトリを選択します。
* フレームワークの選択画面で```Next.js (Static HTML Export)```を選択します。
  * ```Next.js```ではありません。
* 環境変数を追加します。
  * ```SERVICE_DOMAIN```、```API_KEY```は上記に従ってください。
  * ```NODE_VERSION```は20にしてください。またはローカルで動作が確認できている```Node.js```のバージョン番号を入力しても構いません。このバージョンでコンパイルとデプロイが行われます。
* 一度設定を完了します。ただこれではデプロイがうまくいかないのでそのままプロジェクトの設定画面に向かってください。
* ```互換性フラグ```の設定で、```nodejs_compat```を入力、または選択してください。
  * 直上の```互換性の日付```は2024年11月11日以降にしてください。それ以前についてはバグが存在します。
* デプロイに戻って、```デプロイを再試行```を押してください。
* カスタムドメインで任意のドメインにページを表示できます。ドメインもCloudflareで所有する場合、自動でDNSレコード（CNAME）の設定も済ませてくれます。
* microCMSで更新したらデプロイが自動で走る設定にできます。
  * Cloudflare Pagesの当該プロジェクトでデプロイフックを生成します。HTTPSをコピーします。
  * microCMSでデプロイフックを登録します。Cloudflare Pagesが選べるはずです。
    * デプロイを行うタイミングは、下書きの作成、編集、削除を除くすべてを指定しています。この指定したタイミングでデプロイが走ります。
  * （豆知識）このページは、アクセスがあった際に動的にmicroCMSを見るのでは**なく**、デプロイした時にmicroCMSからデータを得て、データをもとにサイトを生成しています。すなわちデプロイをした時のデータから変わりません。そのためmicroCMSで登録したデータを反映するためには、その都度デプロイが必要なのです。

## Getting Started

開発、編集においては、以下のコマンドを入れることで実際のHPが表示されます。ファイルを更新すると動的にリロードが行われるので、事前に開いておくといいかもしれないです。ファイルを追加・削除、参照先を変更などすると動作がしない可能性があります。Ctrl+Cを2回押して終了して再度以下のコマンドを行って再起動しましょう。

First, run the development server:

```bash
# 基本npmで行ってください
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

基本的に[http://localhost:3000](http://localhost:3000)を開けばホームページが確認できます。なおすでにポート3000番が使われている場合は3001番など別のポートが使われます。ターミナルに書かれているURLを確認してください。
編集を保存すると基本的にリアルタイムで反映されます。反映されない場合は更新してください。

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

## ニュースの追加・編集
microCMSにアクセスしてください。渋渋理科部のメールアドレスのアカウント、または追加で権限を与えたアカウントでログインが可能です。
ログインできたら、microCMS上でニュースを書くことができます。

## ページの作り方・仕組み
* ```/app/```以下のファイルがそのままページとなります。ページはこの中にのみ作ることができます。
  * ページとなるのは```page.mdx```、```page.tsx```など、```page```で始まるファイルのみです。
    * ファイル名を変えるとページとして認識されません。
    * 複数のページを作るときは、フォルダを作って、その中にpage.mdxを入れてください。
  * マークダウンで書くときは```.mdx```または```.md```ファイルとしてください。
    * ```.mdx```はマークダウンに対してJSXを挿入して書けるファイル形式です。マークダウンの中にJSXでコンポーネントを追加することができます。
      * JSXはHTMLタグのようなものと思っておいてください。
      * また、他の場所に置いておいたパーツを呼び出して使うことができます（ロボコンで言うとヘッダファイルをインクルードするようなもの）。例えばトップページの```page.mdx```では、```<Hero ...（中略）... />```というタグがあると思います。これは最初の方の行で示した```import {Hero} from "@/components/index/Hero.tsx"```とあるように```/components/index/Hero.tsx```を参照して、この内容を全てコピーして表示するようになっています。
  * ```/app/page.mdx```はWebサイトでは```yasarobo.sclub.dev```の直下に、```/app/test/page.mdx```はWebサイトでは```yasarobo.sclub.dev/test/```としてアクセスできます。
* 画像などの静的ファイルは```/public/```以下に入れてください。
  * ```/public/test/1.jpg```は、Webサイトでは```yasarobo.sclub.dev/test/1.jpg```としてアクセスできます。
  * ```/public/component-img/```以下の画像ファイルは、ページのデザインにおいて使っています（見出しや区切り線など）。消去しないでください。

Markdownの対応記法はドキュメント末尾に記載します。

### トップページの編集方法
通常のページはマークダウンで書いたり編集したりして公開が可能ですが、トップページは他のファイルからコンポーネントを呼び出すことで複雑なデザインを実現しています。
基本的にマークダウンで書くことができますが、ここだけ特殊というところを以下に示します。

#### Hero
トップページ一番上のあの赤と黄色と青の四角形のやつです。基本的に引数を変更することで内容を編集してください。
いじろうと思えば軽いReactの知識があれば、```/components/index/Hero.tsx```を参照して編集することも可能ですが、基本的には引数の部分の編集で十分事足りるはずです。

## ロゴの出し方
コンポーネントにする予定。後ほど公開

* 引数の内容は今後説明を追加します。

### 対応する書き方
https://zenn.dev/hayato94087/articles/1411f7af3eaee4

上の文献を参考にしてください。
```/app/mdx-sample/```の中の内容も同じ内容です。

## 公開
編集してGitHubにプッシュすると、自動でCloudflare Pagesにデプロイが行われ、更新が完了します。GitHub上でデプロイの成否は確認できるはずです。


## Markdownの対応記法
以下の記法に対応します。HTMLに変換されたうえで、ホームページのテーマデザインが自動で適用されます。

### 見出し
* ```#``` 見出し1：ページ全体のタイトルとして表示します。ページ内での見出しは原則見出し2以下を使うこと。
  * ```# *Head* *見出し*```のように、まず英語のタイトルを書いたうえで日本語の見出しを書くことを推奨します。両方を```*```（アスタリスク）で囲い、間にスペースを入れてください。
* ```##``` 見出し2：章の見出し。
  * ```## *Head* *見出し*```のように、まず英語のタイトルを書いたうえで日本語の見出しを書くことを推奨します。両方を```*```（アスタリスク）で囲い、間にスペースを入れてください。
  * ```## *Head*```のように1つだけでも動作します。
* ```###``` 見出し3：節の見出しなど。
以下、見出しは6まで対応します。

### リンク
```[内容](リンクURL)```

### テーブル
```
|表見出し|表見出し|
|---|---|
|内容|内容|
|内容|内容|
```

### 区切り線
```---```、```***```
